<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="generator" content="Jekyll">

  <title>CVE-2020-26894 Privilege Escalation Vulnerability in LiveCode v9.6.1 Programming Language</title>

  <link rel="stylesheet" href="/css/main.css">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" /> <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>CVE-2020-26894 Privilege Escalation Vulnerability in LiveCode v9.6.1 Programming Language | John Woodman’s Security Blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="CVE-2020-26894 Privilege Escalation Vulnerability in LiveCode v9.6.1 Programming Language" />
<meta name="author" content="John Woodman" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Summary LiveCode v9.6.1 for Windows is vulnerable to a horizontal privilege escalation vulnerability." />
<meta property="og:description" content="Summary LiveCode v9.6.1 for Windows is vulnerable to a horizontal privilege escalation vulnerability." />
<meta property="og:site_name" content="John Woodman’s Security Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-10-21T00:00:00+00:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"CVE-2020-26894 Privilege Escalation Vulnerability in LiveCode v9.6.1 Programming Language","dateModified":"2020-10-21T00:00:00+00:00","datePublished":"2020-10-21T00:00:00+00:00","author":{"@type":"Person","name":"John Woodman"},"url":"/posts/LiveCode-Privilege-Escalation-Vulnerability/","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/LiveCode-Privilege-Escalation-Vulnerability/"},"description":"Summary LiveCode v9.6.1 for Windows is vulnerable to a horizontal privilege escalation vulnerability.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>
  <div id="wrapper">
    <header>
  <div>
    <a href="/">
    
    <h1>john@home:~$</h1>
    </a>
    <div class="header-links">
      <a href="/archive"><h2 class="header-link">Archive</h2></a>
<a href="/about"><h2 class="header-link">About</h2></a>
<a href="/hackthebox"><h2 class="header-link">HackTheBox</h2></a>
<a href="/ctf"><h2 class="header-link">CTF</h2></a>
<a href="https://twitter.john-woodman.com" target="_blank"><h2 class="header-link">HackerTwitter</h2></a>
<a href="/gardening"><h2 class="header-link">Gardening</h2></a>
<a href="/atom.xml"><h2 class="header-link">RSS</h2></a>
<a href="https://twitter.com/JohnWoodman15" target="_blank"><h2 class="header-link"><img src="/assets/twitter.png" style="vertical-align:middle" width="45"/></h2></a>
<a href="https://github.com/JohnWoodman" target="_blank"><h2 class="header-link"><img src="/assets/github.png" style="vertical-align:middle; margin-left:-7px" width="45"/></h2></a>

    </div>
  </div>
</header>

    <div class="container">
      <section id="main_content">
        <article>
  <h1>CVE-2020-26894 Privilege Escalation Vulnerability in LiveCode v9.6.1 Programming Language</h1>
  <time datetime="2020-10-21T00:00:00+00:00" class="by-line">21 Oct 2020</time>
  <h1 id="summary"><a href="#header-1"></a>Summary</h1>
<p>LiveCode v9.6.1 for Windows is vulnerable to a horizontal privilege escalation vulnerability.</p>

<p>CVE Mitre Assigned: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-26894">CVE-2020-26894</a></p>

<h1 id="discovery"><a href="#header-2"></a>Discovery</h1>
<p>While taking a Wildlife Issues course at my University, I discovered a high severity vulnerability in the course software our class was using that leads to a horizontal privilege escalation.</p>

<p>At first, I thought the vulnerability was only in this course software, but looking into it deeper and with the help of one of the developers at faulkner press, we discovered that the vulnerability actually lied in the programming language/framework they were using: LiveCode.</p>

<p>For those who aren’t familiar, <a href="https://livecode.com/">LiveCode</a> is a high-level scripting language belonging to the family of xTalk scripting languages along side HypderCard’s <a href="https://en.wikipedia.org/wiki/HyperTalk">HyperTalk</a>, allowing you to build cross-platform applications with relative ease.</p>

<h1 id="vulnerability"><a href="#header-3"></a>Vulnerability</h1>
<p>LiveCode has a function called “shell()” which, as you would expect, allows you to run shell commands and store its output. Most high-level programming languages that have a similar shell command function will use the environment variable %COMSPEC in Windows to determine the location of the shell to use to run the command, unless otherwise specified by the programmer. For Linux, it will usually use “/bin/sh”.</p>

<p>LiveCode v9.6.1, however, does not reference %COMSPEC when attempting to locate cmd.exe to run the “shell()” function. This is dangerous, since it means it will follow the <a href="https://docs.microsoft.com/en-us/previous-versions//cc723564(v=technet.10)#command-search-sequence">command search sequence</a>. This will force the application to check the current directory of the application for cmd.exe before checking %PATH.</p>

<p>This means that if the folder the application is running in is world writable (such as being installed in the root drive), then a low privileged user can create a malicious cmd.exe in that folder, which will be executed every time the application is started by any user on the system, and will assume the privileges of that user. This is known as horizontal privilege escalation.</p>

<p>After contacting LiveCode, the vulnerability has been patched in LiveCode 9.6.2-rc-1</p>

<p>Commit: <a href="https://github.com/livecode/livecode/commit/9bd23b2008a51c9913513c1af014a76a9ff67dbe">9bd23b2</a> &amp; <a href="https://github.com/livecode/livecode-ide/commit/f309d60d2323c08b7d04425be3fef0c805808c5c">f309d60</a></p>

<p>LiveCode Bug Report: <a href="https://quality.livecode.com/show_bug.cgi?id=22942">https://quality.livecode.com/show_bug.cgi?id=22942</a></p>

<p>CVE Mitre Assigned: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-26894">CVE-2020-26894</a></p>

<h1 id="workaround"><a href="#header-4"></a>Workaround</h1>
<p>For those who need a workaround and can’t update, use the following command to tell the “shell()” function to use C:\Windows\System32\cmd.exe</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set the shellCommand to "C:\Windows\System32\cmd.exe"
</code></pre></div></div>

<h1 id="proof-of-concept"><a href="#header-5"></a>Proof-of-Concept</h1>

<p>The following is code that is vulnerable to cmd.exe hijacking:
<img src="/assets/2020-10-21-LiveCode-Privilege-Escalation-Vulnerability/1.png" alt="" height="100%" width="100%" style="display: block; margin-right: auto;" /></p>

<p>As you can see below, procmon shows that the vulnerable application is attempting to first get “cmd.exe” from the folder the application is running in before using C:\Windows\System32\cmd.exe.
<img src="/assets/2020-10-21-LiveCode-Privilege-Escalation-Vulnerability/2.png" alt="" height="100%" width="100%" style="display: block; margin-right: auto;" /></p>

<p>And below is a PoC exploitation of the vulnerable application to pop calc by simply copying calc.exe into the folder of the application and naming it cmd.exe.
<img src="/assets/2020-10-21-LiveCode-Privilege-Escalation-Vulnerability/3.png" alt="" height="100%" width="100%" style="display: block; margin-right: auto;" /></p>

</article>

      </section>
    </div>
  </div>

   <footer>
  <a href="https://creativecommons.org/licenses/by-nc/3.0/deed.en_US">
    <span>
        <b>John Woodman</b>
    </span>
    
    <span>© 2020</span>
  </a>
</footer>

  
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-154967710-1', 'auto');
  ga('send', 'pageview');
</script>
  
</body>

</html>